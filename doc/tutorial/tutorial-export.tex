
\section{Working with external software and exporting data}

\subsection{Checking VDJ designations with other software}
For some studies, VDJ designations are very important.
In the list and in the sequence panel, those designations are written in their
short form.

\question{Put the mouse cursor over a clonotype. In the status bar (between the
  grid and the sequence panel), the complete designation appears.}

We can double check this designation with other popular software.
\question{Select a few clonotypes of the same locus.} % issue #5007
\marginpar{This requires an internet connection.}
\question{Click on the spin icon in the aligner panel header (the rightmost
icon of the left part). The
  clonotype sequences are sent to IMGT/V-QUEST and the results from
  IMGT/V-QUEST are automatically retrieved by Vidjil.
  Once the spin icon changes to a tick, the informations have been
  successfully obtained.
}
\question{Then, go to the next menu on the left and  tick the checkbox
\com{[IMGT] V/D/J genes}. In the sequence panel the boundaries of
  the V(D)J genes as computed by IMGT/V-QUEST are underlined.
Thus you can compare the boundaries of the genes according to IMGT
(underlined) and according to Vidjil (highlighted).
}
  
Note that data returned by IMGT/V-QUEST is available by clicking on the \textit{i} icon of analyzed clonotypes,
enabling you to compare the annotations made by the original software and by IMGT/V-QUEST. 


%%% Un peu trop spécifique ?
\question{Search a clonotype with sequence
\textit{GCAGCCTAAAGGCTGAGGACACCCGACAGGGTATGGACGTCTGGGGCCAA} and select
it. Send this clonotype to IMGT/V-QUEST so that Vidjil retrieves the results
in order to get the identity percentage of the V gene. Note this value for later comparaison.}

\question{As seen previously (see question~\ref{q:biomed}), change the primer set to \textit{Biomed2} that is the set use for this sequencing.}
\question{Reopen the settings menu and check the line \textit{trim primers
before external analysis}. Relaunch IMGT and observe variation of the V
identity percentage. What happened ?}
% A voir avec l'issue #5013

\begin{verbatim}
\end{verbatim}

\question{You can also directly send the sequences to IMGT/V-QUEST, IgBlast,
Blast or AssignSubsets
  by clicking the corresponding buttons in the \textit{External analysis} menu. This opens a new page with the
  corresponding website.}

\bigskip

It may happen the software makes a mistake in the VDJ designation.
In such a case you're very welcome to report us the problem
and we will try to improve the designation algorithm.

\question{Go in the \com{Help} menu and click on \com{get
    support}. It opens your mailer with a pre-composed email
    describing the data you are on as well as the clonotypes you selected.}.

Even if you do not use the \com{get support} button, it's a good practice
to send the complete address showing in your web browser, such
as  \url{http://app.vidjil.org/?set=3241&config=39&plot=v,size,bar},
when you want to discuss with colleagues or with us your data or your analyses.

\bigskip

Suppose that you would like to change the VDJ designation shown on the web application.
\question{Click on the \textit{i} icon in the list of clonotypes for the clonotype you
  want to change the designation. In the segmentation part, click the edit
  button. Choose what you would like to modify.}

Beware: the modifications you made (name changes, clusters, clonotype
tagging, sample reordering\dots) will \textbf{not} be automatically saved. You have to save
your changes by yourself either by clicking on \com{save patient} in the top left menu (where the
``patient'' name is written) or by using the \texttt{Ctrl+S} keyboard
shortcut.
For this demonstration data, you cannot save your changes as you do not have
the rights to modify this patient.

% TODO : créer un should-vdj automatiquement !
\subsection{Exporting reports}

You can generate reports following predefined or custom templates, using different report sections
to reflect the sample/disease you are analyzing.

\question{In the export menu, open the report menu with \textit{export report}.}

We start with the default \textit{Full report}.
You can custom this report buy showing or hiding any \textit{sample},
showing or hiding any \textit{locus}, selecting the \textit{colors} for all clonotypes and for selected clonotypes,
updating the \textit{clonotypes} you previously selected (with "star"),  possibly removing them for the report,
and finally adding, moving, or deleting *reports sections*, including plots you previously selected (within the “plot“ menu).

\question{Close the report. Select clonotype by using the "star" button (status bar, bottom right), and "add to next report".
Reopen the report menu.  What happens?}

% On any grid or bar plot, open the “plot“ menu and again `add to next report`. These plots will keep the exact composition (X/Y axes, clonotype/axes filters).



\question{Click on \textit{Show report} button.}

The generated report can be updated, commented, saved, or printed.

\question{Hover inside a section. What are the four icons that appear in ?}

Note that the modifications you have done there will apply to report sections on the main vidjil page.
% actualiser le menu dans la main page dans ce cas.
% Bug sur la section clonotype
%   pas de bouton dans le cas de la section clones...
%   Clone toujours à la fin
% Une section plot est toujours présente par défaut.
% Quand je recharge la page, mes presets disparaissent ? 
%  Il faut les recharger depuis les cookies ?


Close the export menu and select the first time point and preset \textit{reads length distributions}.
Open the graphic menu and change axis X limits. Set it from 250 to 350.
Click in this menu in button \textit{Add to next report}. 
Regenerate a report and see the presence of this new section, with same limits.
Note that this graphic keep on the selected time point at the moment of his creation.
% button add to next report devrait avoir un pointer.

Once you composed the report as you attended it to be for your purpose, you can choose to save it to found this preset next time, present in the preset list.

\subsection{Other exporting options}

From export menu, multiple possiblities is offer to export analysis content.
\begin{itemize}
  \item top and bottom graphics:  download a static image corresponding to the graphics view
  \item csv:  download detailed information on each clonotype, including ratio in
complete or incomplete locus % toujours utile avec le airr ?
  \item fasta: open a new browser tab with selected clonotypes in fasta format plus their germline sequences. You can choose to copy/paste this content.
  \item airr: download a CSV file that contains the clonotype detailed
informations in AIRR format (see \url{https://www.vidjil.org/doc/vidjil-algo/#airr-tsv-output}). This format is shared by multiple repertoire analysis software. 
\end{itemize}

Select the major TRG clonotypes of the last timepoint.

Note that the AIRR export file will contain only lines for the samples where the clonotype is present.

\question{ Select some clonotypes and align them. The alignment can be
  exported with the \com{export aligned fasta} button in the
  \com{import/export} menu.}
% lever un message flash si export selected airr sans selection active.


Open a detailed description of it by clicking in the {i icon} present in the clonotypeq list row or in the segmenter panel if already selected (You can also open it by double clicking on it from the plot view).


At the line clonotype size, click on download icon and wait a little. 
A search is done inside the selected sample for the clonotype window and a file will be downloadable. 
This can take time. 
% Afficher un flash quand on reçoit un de ces fichiers ? 

\begin{verbatim}
  ///////////////////////////
  cy.log("// test_D_export_01")

    cy.log("TODO, no tutorial testing on export menu/report")
    // TODO

\end{verbatim}
