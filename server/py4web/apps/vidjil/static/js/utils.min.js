"user strict";if(!String.prototype.format){String.prototype.format=function(args){return this.replace(/\{([^}]+)\}/g,function(match,k){return args[k];});};}
window.Q=function(sel,el){return(el||document).querySelectorAll(sel);};utils={};Q.get_query=function(source){source=source||window.location.search.substring(1);var vars={},items=source.split('&');items.map(function(item){var pair=item.split('=');vars[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1]);});return vars;};Q.get_cookie=function(name){var cookie=RegExp(""+name+"[^;]+").exec(document.cookie);if(!cookie)return null;return decodeURIComponent(!!cookie?cookie.toString().replace(/^[^=]+./,""):"");};Q.get_session_token=function(){var app_name=Q.get_cookie('app_name');return Q.get_cookie(app_name+'_session');};Q.clone=function(data){return JSON.parse(JSON.stringify(data));};Q.retrieve=function(key){try{return JSON.parse(window.localStorage.getItem(key));}catch(e){return null;}};Q.store=function(key,value){window.localStorage.setItem(key,JSON.stringify(value));};Q.register_vue_component=function(name,src,onload){Vue.component(name,function(resolve,reject){axios.get(src).then(function(data){resolve(onload(data));});});};Q.upload_helper=function(element_id,callback){var element=document.getElementById(element_id);if(element){var files=element.files;var reader=new FileReader();if(files&&files[0]){reader.onload=function(event){var b64=btoa(event.target.result);callback(files[0].name,b64);};reader.readAsBinaryString(files[0]);}else{callback();}}};var T=function(text){var obj={toString:function(){return T.format(text);},format:function(args){return T.format(text,args);}};return obj;};T.format=function(text,args){args=args||{};translations=(T.translations||{})[text];var n=('n'in args)?args.n:1;if(translations){var k=0;for(var key in translations){var i=parseInt(key);if(i<=n)k=i;else break;}
text=translations[k];}
return text;};Q.debounce=(func,wait)=>{let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};};Q.throttle=(callback,delay)=>{let throttleTimeout=null;let storedEvent=null;const throttledEventHandler=event=>{storedEvent=event;const shouldHandleEvent=!throttleTimeout;if(shouldHandleEvent){callback(storedEvent);storedEvent=null;throttleTimeout=setTimeout(()=>{throttleTimeout=null;if(storedEvent){throttledEventHandler(storedEvent);}},delay);}};return throttledEventHandler;};Q.app=function(element_id){self={};self.element_id=element_id||'vue';self.data={loading:0,page:null,state:null};self.methods={};self.filters={};self.watch={};self.pages={};self.methods.T=T;self.methods.toggle=function(obj,key){obj[key]=!obj[key]};self.methods.set=function(obj,key,value){obj[key]=value;};self.methods.go=function(page,state,push){self.v.loading++;var pagecall=self.pages[page];if(pagecall)pagecall(state,function(){if(push){var path=self.base+'/'+page;if(state)for(var key in state)path+='/'+key+'/'+state[key];window.history.pushState(self.v,page,path);}
self.v.loading--;self.v.page=page;self.v.state=state;});};self.onpopstate=function(event){for(var key in event.state)self.v[key]=event.state[key];};self.start=function(base){self.base=base=base||window.location.href;;self.v=new Vue({el:'#'+self.element_id,data:self.data,methods:self.methods,watch:self.watch,filters:self.filters});var parts=window.location.href.substr(base.length);var page=parts[0];var state={};for(var i=1;i<parts.length;i+=2)state[parts[i]]=parts[i+1];self.v.go(page,state,false);window.onpopstate=self.onpopstate;};return self;};Q.tags_input=function(selector,options){if(options.tags===undefined)options.tags=[];if(options.freetext===undefined)options.freetext=true;if(options.transform===undefined)options.transform=function(x){return x.toLowerCase();}
if(options.labels===undefined)options.labels={};if(options.placeholder===undefined)options.placeholder="";if(options.autocomplete_list===undefined)options.autocomplete_list=null;var tags=options.tags;var elem=Q(selector)[0];if(!elem){console.log('Q.tags_input: element '+selector+' not found');return;}
elem.type="hidden";var repl=document.createElement('ul');repl.classList.add('tags-list')
elem.parentNode.insertBefore(repl,elem);var keys=eval('('+(elem.value||'[]')+')');keys.map(function(x){if(tags.indexOf(x)<0)tags.push(x);});var fill=function(elem,repl){repl.innerHTML='';tags.forEach(function(x){var item=document.createElement('li');item.innerHTML=options.labels[x]||x;item.dataset.value=x;if(keys.indexOf(x)>=0)item.classList.add('selected');repl.appendChild(item);item.onclick=function(evt){if(keys.indexOf(x)<0)keys.push(x);else keys=keys.filter(function(y){return x!=y;});elem.value=JSON.stringify(keys);item.classList.toggle('selected');};});};if(options.freetext){var inp=document.createElement('input');elem.parentNode.insertBefore(inp,elem);inp.classList=elem.classList;inp.placeholder=options.placeholder;inp.setAttribute('list',options.autocomplete_list);inp.onchange=function(evt){inp.value.split(',').map(function(x){x=options.transform(x.trim());if(x&&tags.indexOf(x)<0)tags.push(x);if(x&&keys.indexOf(x)<0)keys.push(x);});inp.value='';elem.value=JSON.stringify(keys);fill(elem,repl);};}
fill(elem,repl);};Q.score_password=function(text){var score=-10,counters={};text.split('').map(function(c){counters[c]=(counters[c]||0)+1;score+=5/counters[c];});[/\d/,/[a-z]/,/[A-Z]/,/\W/].map(function(re){score+=re.test(text)?10:0;});return Math.round(Math.max(0,score));};Q.score_input=function(selector,reference){var elem=Q(selector)[0];reference=reference||100;if(elem){elem.style.backgroundPosition='center right';elem.style.backgroundRepeat='no-repeat';elem.onkeyup=elem.onchange=function(evt){var score=Q.score_password(elem.value.trim());var r=Math.round(255*Math.max(0,Math.min(2-2*score/reference,1)));var g=Math.round(255*Math.max(0,Math.min(2*score/reference,1)));elem.style.backgroundImage=(score==0)?"":("url('"+'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" width="30"><circle cx="5" cy="5" r="3" stroke-width="0" fill="rgb('+r+','+g+',0)"/></svg>'+"')");};}};Q.trap_form=function(action,element_id){Q('#'+element_id+' form').forEach(function(form){if(form.classList.contains('py4web_notrap'))return;var target=form.dataset['py4web_target']||element_id;form.dataset['py4web_target']=target;var url=form.action;if(url===''||url==='#'||url===void 0)url=action;var clickable='input[type=submit], input[type=image], button[type=submit], button:not([type])';form.querySelectorAll(clickable).forEach(function(element){element.onclick=function(event){event.preventDefault();form.querySelectorAll(clickable).forEach(function(element){element.disabled=true;});var form_data=new FormData(form);Q.load_and_trap('POST',url,form_data,target);};});});};Q.load_and_trap=function(method,url,form_data,target){method=(method||'GET').toLowerCase();if(target===void 0||target==='')target='py4web_none';var onsuccess=function(res){Q('#'+target)[0].innerHTML=res.data;Q.trap_form(url,target);var flash=res.headers['flash-alert']
if(flash)Q.flash(JSON.parse(flash));};var onerror=function(res){alert('ajax error');};axios[method](url,form_data).then(onsuccess,onerror);};Q.handle_components=function(){Q('py4web-component').forEach(function(element){Q.load_and_trap('GET',element.attributes.url.value,null,element.attributes.id.value);});};Q.handle_flash=function(){var element=Q('#py4web-flash')[0];element.dataset.counter=0;var make_delete_handler=function(node){return function(event){node.parentNode.removeChild(node);};};var make_handler=function(element){return function(event){var id='notification-{0}'.format([element.dataset.counter]);element.dataset.counter=parseInt(element.dataset.counter)+1;var node=document.createElement("div");node.innerHTML='<div role="alert"><span class="close"></span>{0}</div>'.format([event.detail.message]);node=Q('[role="alert"]',node)[0];node.classList.add(event.detail.class||'info');element.appendChild(node);Q('[role="alert"] .close',node)[0].onclick=make_delete_handler(node);};};if(element){element.addEventListener('flash',make_handler(element),false);Q.flash=function(detail){element.dispatchEvent(new CustomEvent('flash',{detail:detail}));};}};Q.handle_components();Q.handle_flash();
